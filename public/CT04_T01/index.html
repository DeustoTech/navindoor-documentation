<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  

  
  <title>T01 Extended Kalman Filter to trajectories | Navindoor MATLAB Toolbox</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Fecha de ultima revisi&amp;oacute;n 16/05/2018 Descripci&amp;oacute;nUtilizaremos el filtro de Kalman ya implementado en MATLAB, por el Control System Toolbox. En ete caso, veremos como se puede utilizar esta">
<meta property="og:type" content="article">
<meta property="og:title" content="T01 Extended Kalman Filter to trajectories">
<meta property="og:url" content="http://yoursite.com/CT04_T01/index.html">
<meta property="og:site_name" content="Navindoor MATLAB Toolbox">
<meta property="og:description" content="Fecha de ultima revisi&amp;oacute;n 16/05/2018 Descripci&amp;oacute;nUtilizaremos el filtro de Kalman ya implementado en MATLAB, por el Control System Toolbox. En ete caso, veremos como se puede utilizar esta">
<meta property="og:locale" content="es">
<meta property="og:image" content="http://yoursite.com/images/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories_01.png">
<meta property="og:image" content="http://yoursite.com/images/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories_02.png">
<meta property="og:image" content="http://yoursite.com/images/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories_03.png">
<meta property="og:updated_time" content="2018-06-21T09:36:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="T01 Extended Kalman Filter to trajectories">
<meta name="twitter:description" content="Fecha de ultima revisi&amp;oacute;n 16/05/2018 Descripci&amp;oacute;nUtilizaremos el filtro de Kalman ya implementado en MATLAB, por el Control System Toolbox. En ete caso, veremos como se puede utilizar esta">
<meta name="twitter:image" content="http://yoursite.com/images/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories_01.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Navindoor MATLAB Toolbox</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="https://github.com/joroya/navindoor">GitHub</a>
        
          <a class="main-nav-link" href="https://github.com/joroya/navindoor/archive/master.zip">Download</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Buscar"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-examples/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/CT04_T01/" class="article-date">
  <time datetime="2018-06-21T09:36:30.000Z" itemprop="datePublished">2018-06-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Examples/">Examples</a>►<a class="article-category-link" href="/categories/Examples/CT04-Signals-Processing/">CT04 Signals Processing</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      T01 Extended Kalman Filter to trajectories
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Fecha de ultima revisi&oacute;n 16/05/2018</p>
<h2 id="Descripci-oacute-n"><a href="#Descripci-oacute-n" class="headerlink" title="Descripci&oacute;n"></a>Descripci&oacute;n</h2><p>Utilizaremos el filtro de Kalman ya implementado en MATLAB, por el <em>Control System Toolbox</em>. En ete caso, veremos como se puede utilizar esta herramienta en nuestro caso concreto. Describiremos esta clase, sin embargo hay mucha m&aacute;s informaci&oacute;n en &eacute;ste enlace: <a href="https://es.mathworks.com/help/control/ref/extendedkalmanfilter.html" target="_blank" rel="noopener">extendedKalmanFilter</a> El filtro de Kalman es un m&eacute;todo de predicci&oacute;n de medidas, en el que se utiliza el conocimiento del comportamiento que puede serguir nuestro sistema (modelo din&aacute;mico) y una serie de medidas que nos permiten estimar alguna variables del sistema.</p>
<p>Suponiendo que <code>x</code> es la variable que queramos predecir, e <code>y</code> es un vector de medidas, las ecuaci&oacute;n para hallar el siguiente valor es el siguiente.</p>
<p>$$<br>x[k] = f(x[k-1],w[k-1] ,u_s[k-1])<br>$$</p>
<p>$$<br>y[k] = h(x[k], v[k] ,u_m[k])<br>$$</p>
<h2 id="Variables-de-entrada"><a href="#Variables-de-entrada" class="headerlink" title="Variables de entrada"></a>Variables de entrada</h2><p>Solo describiremos algunas de las variables de entrada de este filtro, ya que al ser una clase de otro <em>toolbox</em> tiene su propia documentaci&oacute;n de forma m&aacute;s extensa. Los par&aacute;metros principales son:</p>
<ul>
<li><strong>StateTransitionFcn</strong>: Es la la function f descrita en el apartado anterior. Esta funci&oacute;n a partir de el vecotr de estado anterior es capaz de generar el siguiente estado, siguiendo el modelo din&aacute;mico</li>
<li><strong>InitialState</strong>: Como vemos durate todo el proceso de Kalman, se obtiene el vector de estado a partir de un anterior, es por ello qe necesitamos que exista un estado inicial para empezar con el ciclo.</li>
<li><strong>MeasurementFcn</strong>: Es la funci&oacute;n h descrita en el apartado anterior. Esta funci&oacute;n es capaz de corregir el vector de estado dadas una medidas.</li>
<li><strong>MeasurementNoise</strong>: Matriz de covarianza que tienen las medidas.</li>
<li><strong>ProcessNoise</strong>: Matriz de covarianza asociado al modelo din&aacute;mico.</li>
</ul>
<h2 id="Propiedades-del-Objeto"><a href="#Propiedades-del-Objeto" class="headerlink" title="Propiedades del Objeto"></a>Propiedades del Objeto</h2><p>Las propiedades con las que trabajar&eacute;mos en este tutorial son las mismas que las descritas en las variables de entrada. Por las que simplemente las mencionamos sin necesidad de explicarlas.</p>
<ul>
<li>StateTransitionFcn</li>
<li>InitialState</li>
<li>MeasurementFcn</li>
<li>MeasurementNoise</li>
<li>ProcessNoise</li>
</ul>
<h2 id="Sintaxis"><a href="#Sintaxis" class="headerlink" title="Sintaxis"></a>Sintaxis</h2><p>Cargamos un objetos necesarios para la realizaci&oacute;n del ejercicio</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">clear<span class="token punctuation">;</span>
<span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'data/builds/EI_UD_conn_AP_fakes.mat'</span><span class="token punctuation">)</span>
<span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'data/trajs/straj_in_conn_AP_fakes.mat'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Recogemos una secci&oacute;n de trayectoria y el nivel donde transcurre esta.</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">index_traj <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
itraj  <span class="token operator">=</span> straj<span class="token punctuation">.</span><span class="token function">trajs</span><span class="token punctuation">(</span>index_traj<span class="token punctuation">)</span><span class="token punctuation">;</span>
ilevel <span class="token operator">=</span> building<span class="token punctuation">.</span><span class="token function">levels</span><span class="token punctuation">(</span>itraj<span class="token punctuation">.</span>level <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Creamos una se&ntilde;al RSS, con sus par&aacute;metros por defecto</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">iBBSL_RSS <span class="token operator">=</span> <span class="token function">BeaconBasedSgnLevel</span><span class="token punctuation">(</span>itraj<span class="token punctuation">,</span>ilevel<span class="token punctuation">,</span><span class="token string">'RSS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Ya tenemos los objetos necesarios para empezar el ejemplo del Filtro de Kalman</p>
<pre class="line-numbers language-matlab"><code class="language-matlab"><span class="token function">clear</span><span class="token punctuation">(</span><span class="token string">'building'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token string">'straj'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token string">'index*'</span><span class="token punctuation">)</span>
whos
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>  Name           Size             Bytes  Class                  Attributes

  iBBSL_RSS      1x1              33596  BeaconBasedSgnLevel              
  ilevel         1x1             308161  level                            
  itraj          1x1              23232  traj                             


</code></pre><p>Podemos ver de forma gr&aacute;fica la trayectoria que queremos estimar</p>
<pre class="line-numbers language-matlab"><code class="language-matlab"><span class="token function">plot</span><span class="token punctuation">(</span>ilevel<span class="token punctuation">)</span>
hold on
<span class="token function">plot</span><span class="token punctuation">(</span>itraj<span class="token punctuation">)</span>
<span class="token function">xlim</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span> <span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories_01.png" alt=""></p>
<p><strong>Funcion de transici&oacute;n y de medidas</strong></p>
<p>En nuestro caso trabajaremos con un vector de estado tal que</p>
<p>$$<br>x_{state} = [ x \ \  y \ \ v_{x} \ \ v_{y}]^T<br>$$</p>
<p>En nuestro caso, la funci&oacute;n f, es CT04S01_StateTransition</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">type CT04S01_StateTransition<span class="token punctuation">.</span>m
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>
function x_new = CT04S01_StateTransition(x,dt)
%STATETRANSITION 
%     
    F = [ 1 0 dt 0 ; ...
          0 1 0  dt ; ...
          0 0 1  0  ; ... 
          0 0 0  1 ];
    x_new = F*x;
end

</code></pre><p>Esta funci&oacute;n simplemente desarrolla predice es siguiente estado por el m&eacute;todo de euler, y suponiendo que durante ese intervalo de tiempo la velocidad es constante.</p>
<p>$$<br>x(k) = x(k-1) + v_{x}(k-1)dt<br>$$</p>
<p>$$<br>y(k) = y(k-1) + v_{y}(k-1)dt \<br>$$</p>
<p>$$<br>v_{x}(k) = v_{x}(k-1) \<br>$$</p>
<p>$$<br>v_{y}(k) = v_{y}(k-1) \<br>$$</p>
<p>mientras que la funci&oacute;n h, es  CT04S01_Measurement</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">type CT04S01_Measurement<span class="token punctuation">.</span>m
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>
function y = CT04S01_Measurement(x,u)
%MEASUREMENT 
%  u = matrix [mx2] of beacons positions 
%  x = matrix [nx1], [x,y,vx,vy]  
% 
    y = 10*log10(sqrt((x(1) - u(:,1)).^2 + (x(2) - u(:,2) ).^2));
end

</code></pre><p>dado el vector de estado, podemos calcular las distancias a todos los <em>beacons</em></p>
<p><strong>Condiciones iniciales</strong></p>
<p>Tomamos el vector de estado que nos proporciona la trayectoria .</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">x0 <span class="token operator">=</span> itraj<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
y0 <span class="token operator">=</span> itraj<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v0 <span class="token operator">=</span> itraj<span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v0x <span class="token operator">=</span> v0<span class="token operator">*</span><span class="token function">cos</span><span class="token punctuation">(</span>itraj<span class="token punctuation">.</span><span class="token function">angles</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
v0y <span class="token operator">=</span> v0<span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>itraj<span class="token punctuation">.</span><span class="token function">angles</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

initialStateGuess <span class="token operator">=</span> <span class="token punctuation">[</span>x0 y0 v0x v0y<span class="token punctuation">]</span><span class="token operator">'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>
initialStateGuess =

  140.6017
    6.3466
   -6.2342
   -0.3521


</code></pre><p><strong>Constructor del Filtro de Kalman</strong></p>
<p>Para construir el filtro de Kalman simplemnete pasamos las funciones de transici&oacute;n y de medida; ademas de la condici&oacute;n inicial del estado.</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">EKF <span class="token operator">=</span> <span class="token function">extendedKalmanFilter</span><span class="token punctuation">(</span><span class="token operator">@</span>CT04S01_StateTransition<span class="token punctuation">,</span><span class="token operator">@</span>CT04S01_Measurement<span class="token punctuation">,</span>initialStateGuess<span class="token punctuation">)</span>
EKF<span class="token punctuation">.</span>StateTransitionJacobianFcn <span class="token operator">=</span> <span class="token operator">@</span>CT04S01_StateTransition_Jacobian<span class="token punctuation">;</span>
EKF<span class="token punctuation">.</span>MeasurementJacobianFcn     <span class="token operator">=</span> <span class="token operator">@</span>CT04S01_Measurement_Jacobian<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>
EKF = 

  extendedKalmanFilter with properties:

        HasAdditiveProcessNoise: 1
             StateTransitionFcn: @CT04S01_StateTransition
    HasAdditiveMeasurementNoise: 1
                 MeasurementFcn: @CT04S01_Measurement
     StateTransitionJacobianFcn: []
         MeasurementJacobianFcn: []
                          State: [4x1 double]
                StateCovariance: [4x4 double]
                   ProcessNoise: [4x4 double]
               MeasurementNoise: 1


</code></pre><p><strong>Covarianzas del de las  medidas y del modelo</strong></p>
<pre class="line-numbers language-matlab"><code class="language-matlab">sigma_m <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">% desviacion estandar de medicion de attenuacion</span>
sigma_d <span class="token operator">=</span> <span class="token number">5.0</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">% desviacion estandar del modelo</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Agregamos estas desviaciones, creando una matriz de covariancias</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">dt <span class="token operator">=</span> iBBSL_RSS<span class="token punctuation">.</span>dt<span class="token punctuation">;</span>
total_beacon <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>iBBSL_RSS<span class="token punctuation">.</span>beacons<span class="token punctuation">)</span><span class="token punctuation">;</span>
EKF<span class="token punctuation">.</span>MeasurementNoise <span class="token operator">=</span> <span class="token function">diag</span><span class="token punctuation">(</span><span class="token function">repmat</span><span class="token punctuation">(</span>sigma_m<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>total_beacon<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
EKF<span class="token punctuation">.</span>MeasurementNoise
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>
ans =

     4     0     0     0     0     0     0     0
     0     4     0     0     0     0     0     0
     0     0     4     0     0     0     0     0
     0     0     0     4     0     0     0     0
     0     0     0     0     4     0     0     0
     0     0     0     0     0     4     0     0
     0     0     0     0     0     0     4     0
     0     0     0     0     0     0     0     4


</code></pre><pre class="line-numbers language-matlab"><code class="language-matlab">EKF<span class="token punctuation">.</span>ProcessNoise <span class="token operator">=</span> <span class="token function">diag</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>dt<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">4</span> <span class="token punctuation">,</span> dt<span class="token operator">^</span><span class="token number">4</span><span class="token operator">/</span><span class="token number">4</span>  <span class="token punctuation">,</span> dt<span class="token operator">^</span><span class="token number">2</span>  <span class="token punctuation">,</span>  dt<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>sigma_d<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
EKF<span class="token punctuation">.</span>ProcessNoise
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>
ans =

    0.0006         0         0         0
         0    0.0006         0         0
         0         0    0.2500         0
         0         0         0    0.2500


</code></pre><p><strong>M&eacute;todo de ejecuci&oacute;n</strong></p>
<p>Para ejecutar el filtro de Kalman, existe dos funciones llamadas <em>predict</em> y <em>correct</em>. Mostraremos un ejemplo de funcionamiento</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">tf <span class="token operator">=</span> itraj<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ti <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
time_line <span class="token operator">=</span>ti<span class="token operator">:</span>dt<span class="token operator">:</span>tf<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>En este caso las posiciones de los beacons no se modifican por lo que lo guardaremos en una variable u, que ser&aacute; constante en todo el ciclo</p>
<pre class="line-numbers language-matlab"><code class="language-matlab">u <span class="token operator">=</span> <span class="token function">vec2mat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iBBSL_RSS<span class="token punctuation">.</span>beacons<span class="token punctuation">.</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">% creamos  un matriz donde estaran los valores estimados del vector de estado y otra donde guardaremos la distancia entre</span>
<span class="token comment" spellcheck="true">% el punto estimado y el punto real, en cada instante.</span>
estimation <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>iBBSL_RSS<span class="token punctuation">.</span>len<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
error <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>iBBSL_RSS<span class="token punctuation">.</span>len<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

iter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">% Empezamos el ciclo de predicciones y correcciones</span>
<span class="token keyword">for</span> t <span class="token operator">=</span> time_line
    iter <span class="token operator">=</span> iter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">% Predict</span>
    <span class="token comment" spellcheck="true">% ==================</span>
    <span class="token comment" spellcheck="true">% Predecimos el valor de la posici&amp;oacute;n segun el modelo dinamico</span>
    <span class="token function">predict</span><span class="token punctuation">(</span>EKF<span class="token punctuation">,</span>dt<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">% create measurement</span>
    <span class="token comment" spellcheck="true">% ==================</span>
    result <span class="token operator">=</span> <span class="token function">step</span><span class="token punctuation">(</span>iBBSL_RSS<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    values <span class="token operator">=</span> result<span class="token punctuation">.</span>values<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">% en este caso no hace falta recoger result.beacons</span>
    <span class="token comment" spellcheck="true">% ya que los beacons siempre son los mismo, ya que iBBSL_RSS</span>
    <span class="token comment" spellcheck="true">% no ha sido filtrado. Comprobar que iBBSL_RSS.NumMaxAps == 0</span>
    z <span class="token operator">=</span> values<span class="token operator">'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">% z debe se contravariante</span>

    <span class="token comment" spellcheck="true">% correct position</span>
    <span class="token comment" spellcheck="true">% =================</span>
    <span class="token function">correct</span><span class="token punctuation">(</span>EKF<span class="token punctuation">,</span>z<span class="token punctuation">,</span>u<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">% save information</span>
    <span class="token comment" spellcheck="true">% =================</span>
    index_node <span class="token operator">=</span> <span class="token function">time2index</span><span class="token punctuation">(</span>itraj<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    x_real <span class="token operator">=</span> itraj<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span>index_node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    y_real <span class="token operator">=</span> itraj<span class="token punctuation">.</span><span class="token function">nodes</span><span class="token punctuation">(</span>index_node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">estimation</span><span class="token punctuation">(</span>iter<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">=</span> EKF<span class="token punctuation">.</span>State<span class="token operator">'</span><span class="token punctuation">;</span>
    <span class="token function">error</span><span class="token punctuation">(</span>iter<span class="token punctuation">)</span> <span class="token operator">=</span>  <span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">estimation</span><span class="token punctuation">(</span>iter<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> x_real<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">estimation</span><span class="token punctuation">(</span>iter<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> y_real<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Comportamiento del error</strong></p>
<pre class="line-numbers language-matlab"><code class="language-matlab"><span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hold on
<span class="token punctuation">[</span>A<span class="token punctuation">,</span>B<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ecdf</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token operator">~</span><span class="token punctuation">,</span>index_min<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token function">abs</span><span class="token punctuation">(</span>A<span class="token number">-0.9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'90 % ->'</span><span class="token punctuation">,</span><span class="token function">num2str</span><span class="token punctuation">(</span><span class="token function">B</span><span class="token punctuation">(</span>index_min<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">plot</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span>A<span class="token punctuation">,</span><span class="token string">'k'</span><span class="token punctuation">)</span>
grid on
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories_02.png" alt=""></p>
<p><strong>Trayectoria estimada</strong></p>
<p>La variable <em>estimation</em>, contiene la estimaci&oacute;n que se ha hecho de la posici&oacute;n. Podemos compararla gr&aacute;ficamente con la trayectoria real.</p>
<pre class="line-numbers language-matlab"><code class="language-matlab"><span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">plot</span><span class="token punctuation">(</span>itraj<span class="token punctuation">)</span>
hold on
<span class="token function">plot</span><span class="token punctuation">(</span>ilevel<span class="token punctuation">)</span>
<span class="token function">line</span><span class="token punctuation">(</span><span class="token function">estimation</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">estimation</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'Marker'</span><span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span><span class="token string">'Color'</span><span class="token punctuation">,</span><span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token function">xlim</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">50</span> <span class="token number">150</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/CT04_Signals_Processing/T01_Extended_Kalman_Filter_to_trajectories_03.png" alt=""></p>
<p>Tambien podemos ver las dos trayectoria las dos en una animaci&oacute;n</p>
<pre class="line-numbers language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">% Creamos una trayectoria a partir la la matriz _estimation_</span>
itraj_estimation <span class="token operator">=</span> <span class="token function">mat2traj</span><span class="token punctuation">(</span><span class="token function">estimation</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
itraj_estimation<span class="token punctuation">.</span>t <span class="token operator">=</span> itraj<span class="token punctuation">.</span>t<span class="token punctuation">;</span>
itraj_estimation<span class="token punctuation">.</span>v <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">estimation</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">.^</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token function">estimation</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">.^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">% agregamos</span>
itraj_estimation<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token string">'Estimation'</span><span class="token punctuation">;</span>

itraj<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token string">'Real'</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">% Escribir en la consola de MATLAB lo siguiente</span>
<span class="token comment" spellcheck="true">% comparetraj([itraj_estimation itraj],</span><span class="token string">'level'</span><span class="token punctuation">,</span>ilevel<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/CT04_T01/" data-id="cjiodttlg000d4ss4tsylpmw9" class="article-share-link">Compartir</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/CT04_T02/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Nuevo</strong>
      <div class="article-nav-title">
        
          T02 Unscented Kalman Filter to trajetories
        
      </div>
    </a>
  
  
    <a href="/CT03_T05/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Viejo</strong>
      <div class="article-nav-title">T05 Introduction to BeaconFreeSgn</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categorías</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Examples/">Examples</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Examples/CT01-Planimetry/">CT01 Planimetry</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Examples/CT02-Trayectories-Simulation/">CT02 Trayectories Simulation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Examples/CT03-Signals-Simulation/">CT03 Signals Simulation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Examples/CT04-Signals-Processing/">CT04 Signals Processing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Examples/CT05-Methods-Comparison/">CT05 Methods Comparison</a></li></ul></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Jesus Oroya<br>
      Construido por <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="https://github.com/joroya/navindoor" class="mobile-nav-link">GitHub</a>
  
    <a href="https://github.com/joroya/navindoor/archive/master.zip" class="mobile-nav-link">Download</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>